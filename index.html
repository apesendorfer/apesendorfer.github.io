<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title style = "font-family: “Roboto”";>Finesse: A Context-Dependent Thesaurus</title>
        <meta name="description" content = "Enter your text and find meaningful synonyms tailored to your writing. Enjoy!">
        <meta property="og:title" content = "Finesse: Find the Perfect Word">
        <meta property="og:description" content = "Enter your text and find meaningful synonyms tailored to your writing. Enjoy!">
	<link rel="preload" href="https://fonts.googleapis.com/css?family=Roboto&display=swap" as="style">
	<link rel="stylesheet" href="styles.css">
  	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto&display=swap">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    </head>

    <body style="background: #F9E4D9;">
        <section class="">
        <h1 id = "header">Finesse</h1>
        <h3>A Context-Dependent Thesaurus</h3>
          <div>
            <div class="row">
              <div class="col">
                <button id="finesseButton" class="startButton" type="button" onclick="f1()" data-toggle="tooltip" data-placement="top" title="Finesse">Finesse it</button>
              </div>
              
            </div>
          </div>
          <br>
            <div>
                <textarea  id="textarea1" name="name" rows="15" cols="100" placeholder="Your text here "></textarea>
            </div>
            <div id="static-input" style = "max-width: 80%;"></div>
            <div id="choices"></div>
            <div id="tools">
              <button type="button" onclick="change()">Change</button>
              <button type="button" onclick="revert()">Revert</button>
            </div>
            <!-- <div class="out" id="output">Output Text Here</div> -->
          </div>
        </section>
      <br>
      
      <br>
        <script>
        var output_list;
        var input_list;
        var sent_length;
        var punctuation = [".", ",", ";", ":", "!", "?", "-", "`", "--", ")", "]", "}"]
        var inputText;
        function f1() {
          element = document.getElementById("finesseButton");
          element.disabled = true;
          element.style.animation = "bgColor 10s infinite linear";
          inputText = document.getElementById("textarea1").value;
          var payload = {
            method: 'POST', // *GET, POST, PUT, DELETE, etc.
            mode: 'cors', // no-cors, *cors, same-origin
            body: JSON.stringify(inputText),
            headers: {
              'origin': 'https://apesendorfer.github.io',
              'Content-Type': 'application/json',
            // body: JSON.stringify(data) // body data type must match "Content-Type" header
            },
          
          };
          const Url = "https://i7a0fn1zof.execute-api.us-east-2.amazonaws.com/test/suggestions";
          var outputText = "";
          // var input_list;
          fetch(Url, payload)
            .then(function (response) {
              return response.json()
            })
            .then(function (data) {
              // console.log("data: ", data);
              input_list = data[0].slice(1, data[0].length - 1);
              output_list = data[1].slice(1, data[1].length - 1);
              sent_length = input_list.length;
              f2(input_list)
              // document.getElementById("output").innerHTML = data;
            });
          // document.getElementById("output").innerHTML = outputText;
          // var input_list = ["", "Test", "sentence", "."];
          
          
          
        }

        function f2(input_list) {
          text = ""
          for (let i = 0; i < input_list.length; i++) {
            if (input_list[i].length > 0) {
            text += "<span id=\"" + i + "\" onmouseover=\"f3(" + i + ")\"" + " onmouseout=\"f5(this)\">" + input_list[i] + " " + "</span>";
            }
          }
          document.getElementById("static-input").innerHTML = text;
          element = document.getElementById("finesseButton");
          element.disabled = false;
          element.style.animation = "none";
        }
        // EventHandler takes inputs: event, length, i
        var EventHandler = function() {
          console.log("ENTERED ONKEYDOWN")
          console.log("output_list[i].length:", length)
          console.log("i:", num)
          if (event.key === '1' && length > 0) {
            console.log("PRESSED 1")
            document.getElementById(num).innerHTML = document.getElementById("b0").innerHTML + " ";
          }
          if (event.key === '2' && length > 1) {
            document.getElementById(num).innerHTML = document.getElementById("b1").innerHTML + " ";
          }
          if (event.key === '3' && length > 2) {
            document.getElementById(num).innerHTML = document.getElementById("b2").innerHTML + " ";
          }
          if (event.key === '4' && length > 3) {
            document.getElementById(num).innerHTML = document.getElementById("b3").innerHTML + " ";
          }
          if (event.key === '5' && length > 4) {
            document.getElementById(num).innerHTML = document.getElementById("b4").innerHTML + " ";
          }
        }

        function f3(i) {
          var element = document.getElementById(i)
          element.style.fontWeight = "bold";
          element.style.color = "magenta"
          text2 = "";
          length = output_list[i].length;
          num = i;
          if (output_list[i].length > 0) {
            for (let j = 0; j < output_list[i].length; j++) {
              text2 += "<button id=\"b" + j + "\" type=\"button\" onclick=\"f4(this.innerHTML, " + i + ")\">" + output_list[i][j] + "</button>"
            }
          }
          document.getElementById("choices").innerHTML = text2;
          window.addEventListener('keydown', EventHandler.bind(event, length, num));
        }

        function f4(text, i) {
          document.getElementById(i).innerHTML = text + " ";
        }

        function f5(object) {
          object.style.fontWeight = "normal"
          object.style.color = "black"
          console.log("REMOVE EVENTLISTENER")
          window.removeEventListener('keydown', EventHandler);
        }

        function change() {
          str = "";
          for (let i = 0; i < sent_length; i++) {
            if (i + 1 < sent_length) {
              var currentWord = document.getElementById(i).innerHTML;
              var nextWord = document.getElementById(i + 1).innerHTML;
              if (punctuation.includes(nextWord.slice(0, nextWord.length - 1))) {
                str += currentWord.slice(0, currentWord.length - 1);
              }
              else {
                str += document.getElementById(i).innerHTML;
              }
            }
            else {
              str += document.getElementById(i).innerHTML;
            }
          }
          document.getElementById("textarea1").value = str;
        }

        function revert() {
          // str = "";
          // for (let i = 0; i < sent_length; i++) {
          //   str += input_list[i] + " ";
          // }
          // document.getElementById("textarea1").value = str;
          document.getElementById("textarea1").value = inputText;
        }
        </script>
	<footer style = "margin: auto; width: 20%; font-size: 12px;">
  		<p><a href="https://github.com/apesendorfer/finesse" target="_blank">Built with love</a> by Alex & Ben</p>
	</footer>
    </body>
</html>
